import pandas as pd
import matplotlib.pyplot as plt

def load_log(file_path):
    df = pd.read_csv(file_path)
    return df

def analyze_beaconing(df):
    grouped = df.groupby('destination_ip')['timestamp'].apply(list)

    for dest_ip, times in grouped.items():
        intervals = [times[i+1] - times[i] for i in range(len(times)-1)]
        if len(set(intervals)) <= 2 and len(intervals) > 3:
            print(f"[!] Possible beaconing to {dest_ip} - consistent intervals: {intervals}")

def plot_intervals(df, ip_to_plot):
    times = df[df['destination_ip'] == ip_to_plot]['timestamp']
    intervals = [times.iloc[i+1] - times.iloc[i] for i in range(len(times)-1)]

    plt.plot(intervals)
    plt.title(f"Beaconing intervals for {ip_to_plot}")
    plt.xlabel("Connection #")
    plt.ylabel("Interval (seconds)")
    plt.show()

if __name__ == "__main__":
    df = load_log('sample_log.csv')
    analyze_beaconing(df)
